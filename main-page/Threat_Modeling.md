[主页](./../README.md)        [上一页](./Intelligence_Gathering.md)        [下一页](./Vulnerability_Analysis.md)

# 阶段 3 威胁建模 （Threat Modeling）

## 1  一般 （General）

        本节定义了进行渗透测试所需的威胁建模方法。该标准不指定特定模型，而是要求所使用的模型在威胁表示、能力、符合被测试组织的资格以及能够重复应用于未来测试以获得相同结果等方面保持一致。

        该标准关注传统威胁建模的两个关键要素——资产和攻击者（威胁社区/代理）。每个要素分别细分为商业资产和商业过程，以及威胁社区及其能力。

        至少在每次渗透测试中，所有四个要素应明确识别并记录。

        在建模攻击者方面，除了威胁社区（主要是语义上的，能够与组织的商业SWOT分析相联系）和能力（主要是技术性的），还应考虑额外的动机建模内容。这些额外的因素本质上考虑了目标上可用不同资产的价值，并与获取这些资产的成本相结合。作为补充模型，还应对组织进行影响建模，以便提供每个识别资产的损失事件的“如果发生什么？”场景的更准确视图。这应考虑资产的“净”价值、内在价值以及与损失事件相关的其他间接成本。

        任何渗透测试项目的威胁建模阶段对测试人员和组织都至关重要。它提供了关于组织风险偏好和优先级的清晰理解（哪些资产比其他资产更重要？哪些威胁社区更相关？）。此外，它使测试人员能够专注于提供尽可能模拟攻击者工具、技术、能力、可接触性和总体特征的测试，同时牢记组织内部的实际目标，从而确保测试更相关的控制措施、流程和基础设施，而不是单纯的一份IT元素清单。威胁模型应尽可能与被测试组织协调构建，即使在完全黑箱的情况下，测试人员没有任何关于组织的先前信息，仍应基于攻击者的视角结合与目标组织相关的开放源信息（OSINT）创建威胁模型。

        该模型应被清晰记录，并作为最终报告的一部分交付，因为报告中的发现将参考威胁模型，以便生成一个特定于组织的更准确的相关性和风险评分（而非通用的技术评分）。

### 1.1 高级威胁建模过程(High level threat modeling process)

1. 收集相关文档
2. 识别和分类主要资产和次要资产
3. 识别和分类威胁及威胁社区
4. 将威胁社区与主要资产和次要资产进行映射

### 1.2 示例(Example)

        在PTES评估的背景下，内部托管的CRM应用程序可能在测试范围内。存储在后端数据库中的客户信息是一个易于识别的主要资产，因为它直接与在范围内的应用程序相关联。然而，通过审查数据库服务器的技术设计，还可以识别出存储在同一后端数据库服务器上的人力资源数据库是一个次要资产。攻击者可以利用CRM应用程序作为跳板来获取员工信息。在一次基本的威胁建模练习中，某些威胁社区在与CRM应用程序映射时可能被识别为不相关，但通过识别次要资产，威胁态势会突然发生变化。

### 1.3 高级建模工具(High level modeling tools)

        有多种工具可用于识别目标和映射攻击路径。这些工具通常侧重于商业资产（目标系统）和商业过程（攻击方式）。根据项目的性质，渗透测试团队可能会在没有客户意见的情况下进行这些工作；或者他们可能会花费大量时间与客户利益相关者一起识别感兴趣的目标。侧重于商业资产的工具通常需要定量输入，以描述每个潜在目标对测试的重要性。输入也可以是定性的，例如客户首席信息官对某个系统的描述为其是关键业务系统。侧重于商业过程、信息流和技术架构的工具用于识别潜在攻击路径，并选择哪些路径最有可能成功或最有可能被某类对手使用。

## 2 商业资产分析(Business Asset Analysis)

        在威胁建模练习的商业资产分析部分，采取资产中心的视角，对所有资产及其支持的商业流程进行分析，这些资产和流程均在测试范围内。通过分析收集到的文档和访谈组织内相关人员，渗透测试人员能够识别出最有可能成为攻击目标的资产，评估其价值，以及（部分）损失的影响。

### 2.1 组织数据(Organizational Data)

#### 2.1.1 政策、计划和程序(Policies, Plans, and Procedures)

        内部政策、计划和程序定义了组织的运营方式。这些文档十分重要，因为它们有助于识别组织内的关键角色以及维持公司运作的核心业务流程。

#### 2.1.2 产品信息（例如，商业秘密、研发数据）(Product Information (e.g. trade secrets, R&D data))

        与产品相关的信息包括专利、商业秘密、未来计划、源代码、直接影响产品市场价值的支持系统、算法，以及组织视为产品商业成功关键因素的其他信息。

#### 2.1.3 市场信息（计划、路线图等）(Marketing Information (plans, roadmaps, etc.))

        包括与促销、发布、产品变更、市场定位、合作伙伴关系、第三方供应商及与组织内外活动相关的商业计划的市场推广计划。此外，公共关系相关的数据，如合作伙伴、记者、咨询公司及与这些实体的任何通讯细节，也被认为是高度敏感的目标。

#### 2.1.4 财务信息（例如，银行、信用、股权账户）(Financial Information (e.g. bank, credit, equity accounts))

        财务信息通常是组织最为保护的信息之一。这些信息可能包括银行账户信息、信用卡账户信息和/或信用卡号码，以及投资账户等。

#### 2.1.5 技术信息(Technical Information)

        关于组织及其运营的技术信息对渗透测试人员具有特殊的重要性。这类信息通常不是渗透测试的预期交付成果，但它为其他领域提供了有价值的信息，从而促进了测试过程；基础设施设计信息可能为情报收集过程提供重要数据。

- **基础设施设计信息**  
  
  基础设施设计相关信息涉及用于运行组织的所有核心技术和设施，包括工程蓝图、技术布线与连接图、计算设备/网络设计以及应用层数据处理等，这些都被视为基础设施设计信息。

- **系统配置信息**  
  系统配置信息包括配置基线文档、配置检查清单和安全加固程序、组策略信息、操作系统镜像、软件清单等。这些信息有助于发现漏洞，例如通过识别配置错误或过时的软件安装。

- **用户账户凭据**  
  用户账户凭据帮助以非特权级别访问信息系统，只要存在认证手段（例如 VPN、网页门户等）。

- **特权用户账户凭据**  
  特权用户账户凭据帮助以更高的访问级别访问信息系统，只要存在认证手段（例如 VPN、网页门户等）。获取特权用户账户凭据通常会导致被测试的信息系统遭到破坏。

#### 2.1.6 员工数据(Employee Data)

        在此，员工数据被分析为任何可能对组织产生直接影响的数据，这些数据可能被攻击者获取或泄露。那些必须遵守合规要求的组织（如因数据损失或泄露而面临罚款的组织）显然是此类直接损失影响的主要候选者。此外，员工被视为关键资产的组织（例如特定政府机构、与商业秘密相关的专门员工/部门等）也可能受到此类审查。以下列表提供了一些可能被视为威胁建模中商业资产的个人数据领域示例：

- 国家身份证号码（社保号码等）
- 个人可识别信息（PII）
- 受保护的健康信息（PHI）
- 财务信息（例如银行账户、信用账户）

#### 2.1.7 客户数据(Customer Data)

        与员工数据类似，在威胁建模过程中，客户数据被视为商业资产，当这些信息可能导致组织的直接或间接损失时。除了因合规性需求（基于罚款）而产生的法律责任外，当这些数据可以被用于进行欺诈时，另一个因素也会影响组织的责任，组织可能会因欺诈相关的损失而被追究责任或起诉（因为丢失了能够促成欺诈发生的客户信息）。以下列表提供了可能包含相关客户数据的信息领域示例，这些信息应被视为商业资产，以便于威胁建模。

- 国家身份证号码（如社会安全号码等）

- 个人可识别信息（PII）

- 受保护健康信息（PHI）

- 财务账户（例如，银行账户、信用账户、股权账户）

- 供应商数据

        与组织相关的供应商信息被视为关键资产（例如，关键组件制造商、可能涉及商业秘密的与供应商的协议、供给组件的成本分析），以及任何可能通过其供应商影响组织商业运营的数据，被视为商业资产。

- 合作伙伴数据

- “云”服务账户信息

### 2.2 人力资产(Human Assets)

        在识别组织中的人力资产时，我们必须记住，这些资产是更大努力中的一部分，旨在危害组织。因此，被认定为商业资产的人力资产是指那些可能被利用来泄露信息、被操纵以做出不利于组织的决策或行动，或使攻击者进一步危害组织的人力资产。人力资产不一定是公司层级中最高的职位，往往是与先前识别的商业资产相关的关键人员，或在能够访问这些资产的位置。该列表还可以包括通常不与访问受限公司资产相关的员工，但他们可能在某种程度上能够授予对公司物理访问的权限，从而促进安全或程序的漏洞。以下是一些此类资产的示例，应该根据被测组织进行调整。

- 高级管理层
- 行政助理
- 中层管理
- 行政助理
- 技术/团队负责人
- 工程师
- 技术人员
- 人力资源

## 3 业务流程分析(Business Process Analysis)

        企业如果不盈利，就不能称为企业。盈利的方式是通过将原材料或知识经过各种流程加工，提升其价值并创造附加值，从而产生收入。业务流程及其支持的资产（人员、技术、资金）形成了价值链。通过映射这些流程，识别关键与非关键流程，并最终发现其中的缺陷，我们能够了解企业的运作方式、盈利来源，以及特定威胁社区如何导致企业损失。

        在业务流程分析中，我们区分关键业务流程和非关键流程。对于这两类流程，分析方法是相同的，并考虑相同的要素。主要区别在于，关键业务流程所面临的威胁权重与非关键流程不同。然而，必须注意的是，几个非关键流程的聚合可能形成一个场景，从而在某个元素或流程中产生关键缺陷。这类威胁场景应在此阶段进行识别并记录，以便在渗透测试中使用。

### 3.1 支持过程的技术基础设施(Technical infrastructure supporting process)

        由于业务流程通常由IT基础设施（如计算机网络、处理能力、用于信息录入和业务管理的PC等）支持，因此必须识别并映射所有这些元素。这种映射应清晰明了，以便在将威胁模型转化为漏洞映射和利用时使用。

### 3.2 支持过程的信息资产(Information assets supporting process)

        与技术基础设施不同，信息资产是组织中存在的知识库，作为参考或支持材料（例如决策、法律事务、市场营销等）使用。这些资产通常在业务流程中已被识别，并应与技术基础设施一起进行映射，以及任何支持信息资产本身的额外技术基础设施。

### 3.3 支持过程的人力资产(Human assets supporting process)

        涉及业务流程的人力资源应与流程分析同时进行识别（无论是已记录的还是未记录的），每位参与者的角色都应被记录和映射，即使其与特定信息资产或技术基础设施无关。这些人力资产通常是审批子流程、验证子流程或参考（如法律建议）的一部分。这类资产（尤其是与信息资产或技术基础设施无关的资产）将在后续映射到更具社会性而非技术性的攻击向量上。

### 3.4 第三方集成/过程/使用(3rd party integration and/or usage of/by process)

        与支持流程的人力资产类似，任何参与业务流程的第三方也应进行映射。这一类别可能较为复杂，因为它可能同时包含人力资产以及信息或技术资产（例如SaaS提供商）。

## 4 威胁主体/社区分析(Threat Agents/Community Analysis)

        在定义相关的威胁社区和主体时，需要清晰识别威胁的来源，包括其位置（组织内部或外部）、具体的社区以及任何其他相关信息，这些信息将有助于建立特定主体/社区的能力和动机档案。在可能的情况下，应识别具体的威胁主体。否则，就应概述一个更一般的社区，并提供任何支持材料和情报。以下是威胁主体/社区分类的一些示例：

| 内部             | 外部             |
|:-------------- | -------------- |
| 员工             | 业务合作伙伴         |
| 管理层（高层、中层）     | 竞争对手           |
| 管理员（网络、系统、服务器） | 承包商            |
| 开发人员           | 供应商            |
| 工程师            | 国家             |
| 技术人员           | 有组织犯罪          |
| 承包商（及其外部用户）    | 黑客行动者          |
| 一般用户社区         | 脚本小子（娱乐性/随机黑客） |
| 远程支持           |                |

### 4.1 员工（Employees）

        员工是指根据兼职或全职合同直接为公司工作的人员。一般而言，他们并不被视为严重威胁，因为大多数员工依赖公司谋生，并且在受到良好对待的情况下，更倾向于保护公司而非损害公司。员工通常可能涉及数据丢失事件或意外的安全漏洞。在少数情况下，他们可能受到外部力量的诱导，协助入侵，或者出于个人原因进行恶意行为（例如，流氓交易员）。尽管员工的技能水平可能有所不同，但通常处于低到中等水平。

### 4.2 管理层（高层、中层）（Management (Executive, middle)）

        管理层指直接为公司工作的员工，其角色和职责与前述员工相似。由于他们在公司中的职务，管理层通常能够访问特权信息，并可能……

## 5 威胁能力分析（Threat Capability Analysis）

        一旦识别出威胁社区，就必须分析该社区的能力，以构建一个准确的威胁模型，反映其成功对组织实施攻击并危害组织安全的实际可能性。这项分析需要包括技术分析和机会分析（如适用）。

### 5.1 分析使用的工具（Analysis of tools in use）

        这里应列出威胁社区/主体已知可用的所有工具。此外，应分析可能免费获取的工具所需的技能水平，以便有效利用这些工具，并将其映射到威胁能力中。

### 5.2 相关利用/有效载荷的可用性（Availability to relevant exploits/payloads）

        应分析威胁社区/主体获取或开发与组织环境相关的漏洞的能力。同时，还应考虑通过第三方、业务合作伙伴或地下社区访问这些漏洞/有效载荷的途径。

### 5.3 通信机制（Communication mechanisms）

        分析威胁主体/社区可用的通信机制，以评估针对组织的攻击复杂性。这些通信机制范围从简单的公开技术（如加密）到专业工具和服务（如防弹托管、使用投递站点以及利用已知或未知的僵尸网络进行攻击或掩盖源信息）。例如，在测试中，我们会评估组织外部的整体攻击面。然而，通常会忽视另一个重要组成部分：在利用后可能存在的威胁类型。这涉及到检测外泄通道的能力。恰好，渗透测试人员在测试组织检测现代恶意软件命令与控制通道的能力方面具有独特优势。当这一点在测试范围内时，我们建议测试人员创建一系列恶意软件样本，逐步增加用于隐藏命令与控制的混淆程度。目标是首先制作易于被检测的恶意软件，然后逐步提高混淆级别，直到检测变得困难。

### 5.4 可访问性（Accessibility）

        威胁行为者能力分析的最后一个要素是他们对组织及其特定资产的可访问性。综合上述信息，同时考虑可访问性，将使渗透测试能够创建与组织风险相关的清晰场景。

## 6 动机建模（Motivation Modeling）

        应注意威胁代理/社区可能的动机，以便进行进一步分析。攻击者的动机不断变化，例如，像匿名者（Anonymous）和反安全（Antisec）这样的组织所进行的黑客行动主义攻击有所增加。根据每个组织和行业的不同，动机之间会存在细微差别，一些常见的动机包括：

- 利润（直接或间接）
- 黑客行动主义
- 直接仇恨
- 乐趣/声誉
- 进一步访问合作伙伴/相关系统

## 7 查找相关组织被攻击的新闻（Finding relevant news of comparable Organizations being compromised）

        为了提供完整的威胁模型，应该对同一行业内的其他组织进行比较。这一比较应包括与这些组织相关的任何重大事件或新闻，以及它们面临的挑战。这样的比较可以用来验证威胁模型，并为组织提供一个基准，以便进行自我对比（需注意，公开可获得的信息仅代表被比较组织实际面临的威胁和事件的一部分）。

[主页](./../README.md)        [上一页](./Intelligence_Gathering.md)        [下一页](./Vulnerability_Analysis.md)
