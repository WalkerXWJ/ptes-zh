[主页](./../README.md)        [上一页](./Exploitation.md)        [下一页](./Reporting.md)

# 阶段 6 后期利用/后渗透（Post Exploitation）

#### 1. 目的（*Purpose*）

        后渗透阶段的目的是确定被攻陷机器的价值，并保持对该机器的控制以备后用。机器的价值取决于其所存储数据的敏感性以及该机器在进一步攻陷网络中的作用。本阶段描述的方法旨在帮助测试人员识别和记录敏感数据，识别配置设置、通信通道以及与其他网络设备的关系，这些都可用于进一步访问网络，并设置一种或多种方法以便在稍后访问机器。在这些方法与商定的交战规则（Rules of Engagement）不符的情况下，必须遵循交战规则。

#### 2. 交战规则（*Rules of Engagement*）

        以下交战规则专用于渗透测试的后渗透阶段，旨在确保客户的系统不会因测试人员的直接或间接行为而承受不必要的风险，并确保在项目的后渗透阶段遵循双方同意的程序。

##### 2.1 保护客户（*Protect the Client*）

        以下规则是与客户建立的规则指南，确保客户的日常操作和数据不暴露于风险中：

- 除非事先达成协议，否则不会修改客户认为对其基础设施“关键”的服务。进行此类修改的目的是向客户展示攻击者如何可能：
  
  - 提升权限
  
  - 访问特定数据
  
  - 引发拒绝服务

- 对系统执行的所有修改，包括配置更改，必须被记录。在完成修改的预期目的后，所有设置应尽可能恢复至原始状态。变更列表应在接触后交给客户，以便他们确保所有变更已正确撤销。无法恢复到原始状态的更改应明显区别于已成功撤销的更改。

- 必须详细记录对被攻陷系统采取的行动清单。清单应包括所采取的行动及其发生的时间段。完成后，此清单应作为最终报告的附录。

- 在渗透测试过程中发现的任何和所有私人和/或个人用户数据（包括密码和系统历史记录）只有在满足以下条件时，方可用于获取更多权限或执行与测试相关的其他操作：
  
  - 客户的可接受使用政策声明所有系统均为客户所有，且存储在这些系统上的所有数据均为客户的财产。
  
  - 可接受使用政策声明连接到客户网络被视为同意对连接的机器进行搜索和分析（包括所有当前数据和配置）。
  
  - 客户已确认所有员工已阅读并理解可接受使用政策。

- 密码（包括加密形式的密码）不会包含在最终报告中，或必须足够掩盖以确保报告的接收者无法重现或猜测密码。这是为了保护用户密码的机密性，以及维护它们所保护系统的完整性。

- 任何用于维护对被攻陷系统访问的方法或设备，如果可能影响系统的正常运行或其移除可能导致停机，则不得在未经客户书面同意的情况下实施。

- 任何用于维护对被攻陷系统访问的方法或设备必须采用某种形式的用户身份验证，例如数字证书或登录提示。反向连接到已知的受控系统也是可接受的。

- 测试人员收集的所有数据必须在测试人员使用的系统上加密。

- 报告中包含的可能包含敏感数据的信息（如截图、表格、图形）必须使用无法让报告接收者恢复数据的技术进行处理或掩盖。

- 一旦客户接受了最终报告，所有收集的数据将被销毁。销毁方法和证明将提供给客户。

- 如果收集的数据受任何法律监管，客户将提供用于收集和处理数据的系统及其位置，以确保不违反任何适用法律。如果系统由渗透测试团队提供，数据不得下载并存储到他们的系统中，只能显示访问证明（文件权限、记录数量、文件名等）。

- 未经客户事先同意，不会使用第三方服务进行密码破解，也不会与第三方分享任何其他类型的数据。

- 如果在评估环境中发现先前的攻陷证据，渗透团队在评估期间记录的所有日志，包括行动和时间，将被保存、散列并提供给客户。然后客户可以决定如何最好地回应和处理事件响应。

- 除非在合同/工作说明中明确授权，否则不得删除、清除或修改日志。如获授权，日志必须在任何更改之前备份。

##### 2.2 保护自己（*Protecting Yourself*）

        由于渗透测试的性质，在与客户及您将要执行的任务打交道时，必须确保全面覆盖所有基础。在开始任何工作之前，与客户讨论以下内容，以确保双方对各自的角色和责任有明确的理解。

- 确保合同和/或工作说明由客户和提供者双方签署，确认对被测系统采取的行动是代表并体现客户的意图。

- 在开始测试前，获取指导用户使用公司系统和基础设施的安全政策副本（通常称为“可接受使用”政策）。验证该政策涵盖以下内容：
  
  - 在客户系统上个人使用设备和存储个人员工数据的情况，以及对这些数据的所有权和权利。
  
  - 存储在公司设备上的数据的所有权。

- 确认管理并在客户系统上使用的数据的法规和法律，以及对该数据施加的限制。

- 对接收和存储客户数据的系统及可移动介质使用全盘加密。

- 与客户讨论并建立在发现第三方入侵时要遵循的程序。

- 检查有关捕获和/或存储音频和视频的法律，因为在后渗透阶段使用这些方法可能会被视为违反当地或国家窃听法律。

#### 3. 基础设施分析（*Infrastructure Analysis*）

##### 3.1 网络配置（*Network Configuration*）

        被攻陷机器的网络配置可用于识别其他子网、网络路由器、关键服务器、名称服务器及机器之间的关系。此信息可用于识别其他目标以进一步渗透客户的网络。

###### 3.1.1 接口（*Interfaces*）

        识别机器上的所有网络接口及其IP地址、子网掩码和网关。通过识别接口和设置，可以优先考虑网络和服务的目标。

###### 3.1.2 路由（*Routing*）

        对其他子网、过滤或地址方案的了解可以用于突破分段网络，进而探测和枚举其他主机和/或网络。这些数据可以来自特定主机或网络上的多种来源，包括：

- 接口
- 路由表，包括静态和动态路由
- ARP表、NetBios或用于服务和主机发现的其他网络协议

        对于多宿主机，确定它们是否充当路由器。

###### 3.1.3 DNS 服务器（*DNS Servers*）

        通过评估主机设置识别所有正在使用的DNS服务器。DNS服务器和信息可以用于制定并执行计划，以发现目标网络上的其他主机和服务。如果DNS服务器被攻陷，DNS数据库将提供有关主机和服务的有价值信息，可以用于为其余评估优先排序目标。修改和添加新记录可以用于拦截依赖于DNS的服务的数据。

###### 3.1.4 缓存的 DNS 条目（*Cached DNS Entries*）

        识别缓存中高价值的DNS条目，这可能包括Intranet站点、管理接口或外部站点的登录页面。缓存的接口提供了关于受攻击主机最近和最常使用的主机的信息，提供了主机之间关系和交互的视图，这些信息可以用于进一步渗透目标网络和基础设施时的目标优先级排序。如果允许修改缓存条目，可以用来捕获认证凭证、认证令牌或获取有助于进一步渗透目标网络的服务信息。

###### 3.1.5 代理服务器（*Proxy Servers*）

        识别网络和应用程序级别的代理服务器。在企业范围内使用的代理服务器是良好的攻击目标。对于应用程序代理，可能可以识别、修改和/或监控流量的流动或流量本身。代理攻击通常是展示对客户影响和风险的有效手段。

###### 3.1.6 ARP 条目（*ARP Entries*）

        枚举缓存和静态ARP表条目，这可以揭示与受攻击机器交互的其他主机。静态ARP条目可能代表关键机器。如果评估范围允许拦截和修改ARP条目，则可以简单地展示如何以通常未检测到或未受保护的方式中断、监控或攻破服务的可能性。

##### 3.2 网络服务（*Network Services*）

###### 3.2.1 监听服务（*Listening Services*）

监听服务  
识别目标机器提供的所有网络服务。这可能会发现最初扫描未识别的服务以及其他机器和网络的存在。识别扫描中未显示的服务还可以提供有关网络和/或主机中可能实施的过滤和控制系统的信息。此外，测试人员可能利用这些服务来攻破其他机器。大多数操作系统包括识别与机器之间的TCP和UDP连接的方法。通过检查与受攻击机器之间的连接，可以发现之前未知的关系。同时，还应考虑主机上的服务，这可能揭示在非标准端口上监听的服务，并指出例如SSH的无密钥认证等信任关系。

###### 3.2.2 VPN 连接（*VPN Connections*）

VPN连接  
应识别进入和离开目标机器或网络的所有VPN连接。出站连接可以提供进入新系统的路径，这些系统可能此前未被识别。入站和出站连接都可以识别新系统和可能的业务关系。由于VPN的加密流量难以解密或检查，VPN连接通常绕过防火墙和入侵检测/预防系统。这一特点使得VPN成为发动攻击的理想途径。在对新的目标发起攻击之前，应确认其在评估范围内。目标主机上存在的VPN客户端或服务器连接也可能提供以前未知的凭证，可以用来攻击其他主机和服务。

###### 3.2.3 目录服务（*Directory Services*）

目录服务  
运行目录服务的目标主机可能提供枚举用户账户、主机和/或服务的机会，这些信息可以用于额外的攻击或提供在漏洞分析阶段可能未发现的其他目标。此外，在目录服务中找到的用户详细信息可以用于社交工程和钓鱼攻击，从而提高成功率。

###### 3.2.4 邻居（*Neighbors*）

邻居  
在当今的网络中，许多服务和操作系统使用多种协议来发现邻居，以便更加便捷地访问服务、进行故障排除和配置。根据目标主机的类型，协议有所不同。网络设备可能使用CDP（Cisco Discovery Protocol）和LLDP（链路层发现协议）等协议来识别直接连接或同一子网中的系统、配置和其他细节。同样，桌面和服务器操作系统可能使用mDNS（多播域名服务）和NetBios等协议来发现同一子网内主机和服务的详细信息。

#### 4. 劫掠（*Pillaging*）

搜刮  
搜刮是指从目标主机获取与预评估阶段定义的目标相关的信息（如包含个人信息、信用卡信息、密码等的文件）。获取这些信息可能是为了满足目标需求，或作为进一步访问网络的跳板。数据的位置会因数据类型、主机角色及其他情况而异。熟悉常用应用程序、服务器软件和中间件非常重要，因为大多数应用程序将其数据存储在许多不同的格式和位置。某些系统可能需要特殊工具来获取、提取或读取目标数据。

##### 4.1 安装的程序（*Installed Programs*）

已安装程序

###### 4.1.1 启动项（*Startup Items*）

启动项  
大多数系统会在系统启动或用户登录时运行某些应用程序，这些应用程序可以提供有关系统用途、软件和交互服务的信息。这些信息可能揭示可能存在的防御措施，这些措施可能会阻碍进一步对目标网络及其系统的渗透（例如，HIDS/HIPS、应用程序白名单、FIM）。需要收集的信息包括：

- 系统上安装的应用程序及其对应的版本列表。
- 系统上应用的操作系统更新列表。

##### 4.2 安装的服务（*Installed Services*）

已安装服务  
特定主机上的服务可能服务于主机本身，或目标网络中的其他主机。需要为每个目标主机创建一个配置文件，记录这些服务的配置、用途，以及它们可能如何用于实现评估目标或进一步渗透网络。

###### 4.2.1 安全服务（*Security Services*）

安全服务  
安全服务包括旨在阻止攻击者进入系统并保护数据的软件。这些服务包括但不限于网络防火墙、基于主机的防火墙、IDS/IPS、HIDS/HIPS和防病毒软件。在单个目标主机上识别任何安全服务，可以了解攻击网络中其他机器时可能遇到的情况，以及在测试期间可能触发的警报。这些信息可以在项目总结时与客户讨论，可能导致安全策略、UAC、SELinux、IPSec、Windows安全模板或其他安全规则集/配置的更新。

###### 4.2.2 文件/打印机共享（*File/Printer Shares*）

文件/打印共享  
文件和打印服务器通常包含目标数据，或者提供进一步渗透目标网络和主机的机会。应关注的信息包括：

- 文件服务器提供的共享 - 应检查目标系统提供的任何文件共享。甚至仅共享的名称和注释就可以泄露有关内部应用程序或项目名称的重要信息（例如，如果只有“Fred”和“Christine”可以访问“Accounting”文件夹，或许他们都是会计员工）。
- 共享的访问控制列表和权限 - 从客户端来看，如果可以连接到共享，则应检查连接是只读还是读写。请记住，如果共享包含目录，则不同目录可能适用不同的权限。从服务器端来看，应检查服务器配置和文件/目录权限。
- 文件共享的文件和内容列表 - 从文件共享列表中识别感兴趣的文件。寻找有趣或目标明确的项目，如：
  - 源代码
  - 备份
  - 安装文件
  - 机密数据（电子表格中的财务数据、TXT/PDF格式的银行报告、密码文件等）
- 放置木马或自动运行文件 - 通过巧妙的命名或模仿已经使用的命名约定，可以鼓励用户执行这些负载，允许测试人员进一步渗透网络。如果可以获取文件服务器日志，甚至可以有针对性地目标特定用户。

###### 4.2.3 数据库服务器（*Database Servers*）

数据库服务器

数据库中包含大量可能在评估中被针对的信息。

- 数据库：数据库名称列表可以帮助评估人员确定数据库的用途以及数据库可能包含的数据类型。在有多个数据库的环境中，这将有助于优先排序目标。
- 表：表名和元数据，如注释、列名和类型，也可以帮助评估人员选择目标并找到目标数据。
- 表内容、受监管内容的行数。
- 列：在许多数据库中，可以通过单个命令搜索所有表的所有列名。这可以用来查找目标数据（例如，如果在Oracle数据库上针对信用卡数据，可以尝试执行 `select * from all_tab_columns where name = '%CCN%';`）。
- 数据库和表权限。
- 数据库用户、密码、组和角色。

数据库中托管的信息也可以用于显示风险、实现评估目标、确定服务的配置和功能，或进一步渗透客户网络和主机。

###### 4.2.4 目录服务器（*Directory Servers*）

目录服务器

目录服务的主要目标是为服务和主机提供参考或认证信息。攻破此服务可以控制依赖该服务的所有主机，并提供可用于进一步攻击的信息。需要在目录服务中查找的信息包括：

- 对象列表（用户、密码、机器等）。
- 系统连接。
- 协议和安全级别识别。

###### 4.2.5 名称服务器（*Name Servers*）

名称服务器

名称服务器根据其提供的记录类型为主机和服务提供解析。枚举记录和控制可以提供目标和服务列表，以优先攻击并进一步渗透客户的网络和主机。修改和添加记录的能力可以用于显示拒绝服务的风险，并有助于拦截流量和客户网络上的信息。

###### 4.2.6 部署服务（*Deployment Services*）

部署服务

识别部署服务可以访问并枚举：

- 无人值守的应答文件。
- 文件权限。
- 包含的更新。
- 应用程序和版本。

这些信息可以用于进一步渗透客户网络和主机。修改服务的资源库和配置的能力允许：

- 安装后门。
- 修改服务以使其易受攻击。

###### 4.2.7 证书颁发机构（*Certificate Authority*）

证书颁发机构

识别被攻破的客户端主机上的证书颁发机构服务将允许访问：

- 根证书颁发机构（Root CA）
- 代码签名证书
- 加密和签名证书

控制该服务还可以实现：

- 为多个任务创建新证书
- 撤销证书
- 修改证书吊销列表
- 插入根证书颁发机构证书

控制这些服务显示了风险，并可能导致客户网络和主机上的数据和服务被攻破。

###### 4.2.8 源代码管理服务器（*Source Code Management Server*）

源代码管理服务器

通过运行在被攻破的主机上的服务或服务的客户端部分识别源代码管理系统，提供了以下机会：

- 枚举项目：项目名称可能泄露公司项目的敏感信息。
- 验证对源代码文件的访问。
- 修改源代码文件：如果在范围内允许，修改源代码可以证明攻击者能够进行可能影响系统的更改。
- 枚举开发人员：开发人员的详细信息可用于社会工程攻击，以及作为攻击系统其他区域的输入。
- 枚举配置。

###### 4.2.9 动态主机配置服务器（*Dynamic Host Configuration Server*）

动态主机配置服务器

识别动态主机配置服务或被攻破主机对该服务的使用允许：

- 枚举已分配的租约。
- 枚举配置。
- 枚举选项。
- 修改配置。
- 消耗所有租约。

对该服务的控制可以用于展示拒绝服务攻击的风险，并用于对被攻破网络上的主机和服务进行中间人攻击。

###### 4.2.10 虚拟化（*Virtualization*）

虚拟化

识别虚拟化服务或客户端软件允许：

- 枚举虚拟机（名称、配置、操作系统）。
- 枚举管理系统的密码和数字证书。
- 枚举虚拟化软件配置。
- 主机配置。
- 通过控制虚拟机状态显示拒绝服务的风险。
- 访问托管在虚拟机上的数据。
- 拦截托管在被攻破主机上的虚拟主机或服务的流量。

###### 4.2.11 消息传递（*Messaging*）

消息服务

识别消息服务或客户端软件提供了以下机会：

- 识别目录服务。
- 攻破凭证。
- 访问机密信息。
- 识别网络中的主机。
- 系统和业务关系。

所有这些信息和操作都可以用于展示风险，并进一步渗透客户的网络和主机。

###### 4.2.12 监控和管理（*Monitoring and Management*）

监控与管理

识别用于监控和/或管理的服务或客户端软件可以帮助识别目标网络上的其他服务器和服务。此外，获取的配置参数可能提供对其他目标主机的访问，并且可以确定测试人员的哪些行为能够被客户检测到。需要查找的一些服务包括：

- SNMP（简单网络管理协议）
- Syslog

一些管理服务和软件，可以用于获取凭证、识别主机以及访问其他服务，可能包括：

- SSH服务器/客户端
- Telnet服务器/客户端
- RDP（远程桌面协议）客户端
- 终端服务器
- 虚拟环境管理软件

###### 4.2.13 备份系统（*Backup Systems*）

备份系统

识别用于备份数据的服务或客户端软件为攻击者提供了绝佳的机会，因为这些系统需要访问它们需要备份的数据和系统，这为攻击者提供了：

- 主机和系统的枚举
- 服务的枚举
- 主机和/或服务的凭证
- 访问备份数据

从服务中获取的信息可以用来显示对系统及其信息的机密性、完整性和访问的风险。访问备份也可以提供机会，在客户系统中引入错误配置、易受攻击的软件或后门。

###### 4.2.14 网络服务（RADIUS, TACACS..等）（*Networking Services (RADIUS, TACACS..etc)*）

网络服务（RADIUS、TACACS等）

识别服务或使用网络服务允许：

- 用户的枚举
- 主机和系统的枚举
- 凭证的攻破
- 如果没有其他方法，显示拒绝服务的风险

##### 4.3 敏感数据（*Sensitive Data*）

###### 4.3.1 键盘记录（*Key-logging*）

键盘记录

通过监控按键，可以检测到包括密码和个人识别信息（PII）在内的敏感信息。关于其合法性的问题：如果用户在使用公司软件的同时在私人即时通讯中聊天，这样做是否合法？如果公司声明网络上的所有数据都可以被监控，那么这应该是可以的。如果在“保护自己”部分的第二个要点中提到设备的使用可以被监控，并且不允许个人使用，那就可以。如果政策没有涵盖个人用户或数据的所有权，则不可以。这个政策也应该扩展到网络。

###### 4.3.2 屏幕截图（*Screen capture*）

屏幕截图

屏幕截图可以用来显示被攻破的证据，以及通过其他方式无法访问的信息。通过屏幕截图收集的数据应谨慎处理，以避免显示客户员工或客户的私人数据。

###### 4.3.3 网络流量捕获（*Network traffic capture*）

网络流量捕获

根据网络上的控制措施和用于捕获的媒介，网络流量捕获可以用于：

- 识别网络上的主机
- 拦截数据
- 识别服务
- 识别网络中主机之间的关系
- 捕获凭证

应注意仅捕获参与范围内的流量，并确保捕获的信息不受当地法律控制，如VOIP通话的捕获。保留和展示的信息应经过过滤，以保护客户的客户和/或员工的个人及机密数据。

###### 4.3.4 先前的审计报告（*Previous Audit reports*）

##### 4.4 用户信息（*User Information*）

用户信息

在本节中，主要关注的是目标系统上与用户账户相关的信息，这些账户可能存在于系统上或曾经远程连接并留下了评估人员可以收集和分析的痕迹，以便进一步渗透或实现评估目标。

###### 4.4.1 系统上的（*On System*）

系统上的信息

在已攻破的系统上可以收集到的一般信息包括：

- 历史文件：历史文件存储用户最近执行的命令。阅读这些文件可以揭示系统配置信息、重要应用程序、数据位置和其他系统敏感信息。
- 加密密钥（SSH、PGP/GPG）
- 有趣的文档（.doc/x, .xls/x, password.*）：用户常常在明文文档中存储密码和其他敏感信息。这些信息可以通过两种方式找到：搜索文件名中的有趣词汇，如password.txt，或直接搜索文档内容。索引服务可以提供帮助，例如Linux的locate数据库。
- 用户特定的应用程序配置参数
- 个别应用程序历史记录（仅MRU Windows, 历史文件等）
- 枚举可移动介质
- 枚举网络共享/域权限（gpresult）

###### 4.4.2 网络浏览器（*Web Browsers*）

网页浏览器

从网页浏览器中收集的信息可以用于识别其他主机和系统，并提供进一步渗透客户网络和主机的信息，包括：

- 浏览器历史记录
- 书签
- 下载历史
- 凭证
- 代理
- 插件/扩展

应谨慎确保仅捕获参与范围内的数据，因为网页浏览器中的信息可能包含客户员工的机密和私人数据。这些数据应从返回的数据和报告中进行过滤。

###### 4.4.3 即时通讯客户端（*IM Clients*）

即时通讯客户端

在已攻破的系统上，可以从即时通讯客户端中收集的信息包括：

- 枚举账户配置（用户、密码、服务器、代理）
- 聊天记录

应谨慎确保仅捕获参与范围内的数据，因为即时通讯客户端中的信息可能包含客户员工的机密和私人数据。这些数据应从返回的数据和报告中进行过滤。

##### 4.5 系统配置（*System Configuration*）

###### 4.5.1 密码策略（*Password Policy*）

密码策略

通过枚举系统的密码策略，可以更高效地进行暴力破解密码。例如，知道密码的最小长度是8个字符，可以在字典中删除少于8个字符的词。

。

###### 4.5.2 安全策略（*Security Policies*）

###### 4.5.3 无线网络和密钥的配置（*Configured Wireless Networks and Keys*）

配置的无线网络及其密钥

通过找到目标的无线信息，可以在现场通过公司的WiFi发动物理攻击。这也允许设立一个虚假的接入点，诱使目标在不在现场时连接。

#### 5. 高价值/重要目标（*High Value/Profile Targets*）

高价值/高曝光目标

高价值/高曝光目标可以通过分析从已攻破系统收集的数据以及这些系统的操作和所运行的服务，从预先参与会议中确定的目标中识别和进一步扩展。对这些高价值/高曝光目标的操作和互动的视图有助于识别和衡量由于数据和流程对业务的影响，以及对客户基础设施和服务整体完整性的影响。

#### 6. 数据外泄（*Data Exfiltration*）

##### 6.1 映射所有可能的数据外泄路径（*Mapping of all possible exfiltration paths*）

映射所有可能的数据外泄路径

在每个已获得访问的区域，应创建完整的数据外泄路径。这包括通往外界的次级和三级手段（通过不同的可访问子网等）。一旦提供了映射，就应开始实际的数据外泄测试。

##### 6.2 测试数据外泄路径（*Testing exfiltration paths*）

测试数据外泄路径

根据数据外泄路径映射，应从被测试的组织中提取数据。这应已在预先参与范围界定时涵盖，并应建立符合客户可接受参与政策的适当基础设施（即，外泄的数据通常被提取到测试人员完全控制的服务器，并将访问和所有权权利授予被测试的组织）。外泄本身应模拟与组织相关的威胁建模标准中使用的真实世界外泄策略（即，如果主要是犯罪行为，则使用“标准”外泄，通过网络内的中转区将数据归档在加密的zip/7z文件中，然后发送到互联网上的FTP/HTTP服务器；如果是更复杂的威胁行为者，则使用模拟此类策略和战术的手段进行外泄）。

##### 6.3 测量控制强度（*Measuring control strengths*）

衡量控制强度

在进行数据外泄测试时，测试的主要目标是查看当前检测和阻止敏感信息离开组织的控制措施是否有效，并在检测到任何情况时锻炼响应团队，观察他们如何对这类警报作出反应以及如何调查和缓解事件

#### 7. 持续性（*Persistence*）

持续性

安装需要身份验证的后门。
安装和/或修改服务以连接回系统。至少应使用用户和复杂密码；在可能的情况下，优先使用证书或加密密钥（如SSH、ncat、RDP）。反向连接可以限制为单个IP。
创建具有复杂密码的备用账户。
在可能的情况下，后门必须能在重启后继续存在。

#### 8. 进一步渗透到基础设施（*Further Penetration Into Infrastructure*）

进一步渗透基础设施

横向移动是测试人员利用其在已攻破系统上的存在进一步枚举并访问客户基础设施上的其他系统的行动。这一行动可以从被攻破的主机本身执行，使用本地资源或上传到被攻破系统的工具。

##### 8.1 从已攻陷的系统（*From Compromised System*）

从被攻破的系统执行

可以从被攻破的系统采取的行动包括：

- 上传工具
- 使用本地系统工具
- ARP扫描
- Ping扫描
- 内部网络的DNS枚举
- 目录服务枚举
- 暴力攻击
- 通过管理协议和被攻破的凭证进行枚举和管理（如WinRM、WMI、SMB、SNMP等）
- 滥用被攻破的凭证和密钥（如网页、数据库等）
- 执行远程漏洞利用

要执行的行动将取决于展示特定风险和/或进一步渗透客户网络和主机所需的信息。建议定期进行规划会议，以重新评估收集的信息，并决定继续后期开发的最佳方法，直到实现既定目标。

##### 8.2 通过已攻陷的系统（*Thru Compromised System*）

通过被攻破的系统

可以通过被攻破的系统采取的行动包括：

- 端口转发
- 内部网络代理（SSH）
- 连接到内部网络的VPN
- 执行远程漏洞利用
- 滥用被攻破的凭证和密钥（如网页、数据库等）

要执行的行动将取决于展示特定风险和/或进一步渗透客户网络和主机所需的信息。建议定期进行规划会议，以重新评估收集的信息，并决定继续后期开发的最佳方法，直到实现既定目标。

#### 9. 清理（*Cleanup*）

清理

清理过程涵盖了渗透测试完成后系统清理的要求。这将包括测试期间使用的所有用户账户和二进制文件。

- 从被攻破的系统中移除所有可执行文件、脚本和临时文件。尽可能使用安全删除方法删除文件和文件夹。
- 恢复系统设置和应用程序配置参数的原始值，如果在评估期间进行了修改。
- 移除所有安装的后门和/或rootkit。
- 移除为连接回被攻破系统而创建的所有用户账户。



[主页](./../README.md)        [上一页](./Exploitation.md)        [下一页](./Reporting.md)


